2018 年度未踏ターゲット事業
アニーリングを用いた
ブロックチェーンの高速化技術の開発
1. 背景

 現在のビットコインブロックチェーンはスケーラビリティの問題に直面している。
このスケーラビリティの問題によってビットコインブロックチェーンは実社会の求
める取引ニーズに対応できていない。
 例えば、クレジットカード会社である VISA の取引処理数は約 4000 件(毎秒)と言わ
れているのに対して、ビットコインの取引処理数は約 7 件(毎秒)である。
 上記のようなスケーラビリティ問題の解決策として提示されたのがオフチェーン
技術である。このオフチェーン技術を利用したネットワークの１つが Lightning
Network である(以降 LN)。
2. 目的
アニーリングマシンを使うことで、より効率的に LN の経路探索を行える手法を開
発する。
3. ソフトウェア開発内容
アニーリングマシンによって LN のトランザクションの経路探索を行うための手法
を開発した。開発した手法はニ段階に分かれている。最初に各トランザクションに対
して経路の候補を 3 経路作成する。次にアニーリングマシンを用いてこの候補の中
から最適な経路を選択する。
ここからは、アニーリングマシンを用いて最適な経路を選択する手法について説
明する。まず、LN においてトランザクションの経路が満たすべき条件は以下の２つ
である。
⑴チャネルにはキャパシティが存在し、これ以上の金額のトランザクションが経由す
ることができない
⑵送出したノードからコインを受け取るノードまでの経路はただ１つ
2
LN のネットワークに参加するユニークなコンピューターは通常ノードと呼ばれ、
このノード間で送金を行うことをトランザクションと呼ぶ。このトランザクションが
辿る経路が各ノード間に繋がれたチャネルである。チャネルが扱える取引数量がキャ
パシティである。
チャネルを通過できるトランザクションの総量は双方向の支払いチャネルの作成
時に定められ、この総量を超えての送金は行えない。
また、トランザクションは始点から終点まで１つのルートのみしか辿ることができ
ない。トランザクションの経路探索をアニーリングマシンによって行うため、以上の
2 つの制約を、二値変数 を用いて定式化を行ない、ハミルトニアンを作成した。こ
こで はトランザクション数×候補経路数の二値行列であり、 番目のトランザクシ
ョンが 番目の経路を利用するとき =1 となり、そうでない時は =0 となる。
⑴の制約を以下のハミルトニアンによって表現する。
全てのチャネルに対してそのチャネルを通る容量がキャパシティよりも大きいとペ
ナルティが発生する。また、正の整数であるキャパシティ容量を最小のビット数で表
現するために対数エンコーディングを利用した。
キャパシティコストのハミルトニアン
3
⑵以下はルート制限のハミルトニアンであり、各トランザクションでは 1 つのルー
トのみ選択される。
ルート制限のハミルトニアン
トランザクションはノードを経由するたびに手数料が課されるので、出来るだけ短
い経路が選ばれ、課される手数料を少なくすることが好まれる。トランザクションの
経路の距離を短くするためのハミルトニアンを として導入する。ここで言
及したトランザクションの距離とは経由するチャネルの数を指す。
距離コストのハミルトニアン

キャパシティコストのハミルトニアン、ルート制限のハミルトニアン、距離コス
トのハミルトニアンを踏まえ、以下のハミルトニアンを生成した。
4

今回は富士通デジタルアニーラによってこれらのハミルトニアンによって定義さ
れる経路探索問題を、擬似的に生成したグラフ上でトランザクションの経路を探索す
る問題として解いた。グラフ構造は Python のライブラリである NetworkX2.2 を用い
て生成。ノード数は 2000、チャネル数は 20000 と設定した。各チャネルのキャパシテ
ィのレンジは 200〜900 とし、１つのノードにおおよそ 15〜30 ほどのチャネルがラン
ダムに配置されるように設定した。
また、トランザクションの数は 4、各トランザクションの金額のレンジは 200〜600
とした。各トランザクションには異なる 3 つのルート候補を用意した。チャネルの手
数料に平均 0.1、標準偏差 1 の乱数を掛け合わせたものを手数料の重みとしたグラフ
における最短経路をダイクストラ法によって求め、これをルートの候補とした。
なお、パラメーターの α には 2 を、β にはキャパシティコストのハミルトニアン
でトランザクション金額の二乗分の金額が含まれ出力が大きくなることもあり、対称
性を持たせるためにトランザクション金額の平均値の二乗に 100 を掛け合わせたも
のをパラメーターとして設定した。
上記の経路探索問題を富士通デジタルアニーラの FujituDAPTSolver モード
number_iterations1000000, number_replices100 で計算した結果、解は通信時間を
含め、10 秒で得られた。
また⑴,⑵の制約に加えて短い距離の経路を解として得ることができた。要したビ
ット数は 361 ビットであった。
4. 新規性・優位性
LN のグラフを模したグラフ問題をアニーリングマシンで解くことができた。また、
扱っているトランザクションの数は少ないものの、現在の LN の開発のトップランナ
ーでもある LND という開発チームのもつネットワークの約 2 倍の規模のグラフを解く
足掛かりを掴めたことで将来的な LN のルーティング問題のアニーリングマシンの応
用可能性が示せた。
5
5. 期待されるユーザー価値と社会へのインパクト
Lightning Network の Web サイト内[1]では数百万、数十億の同時トランザクショ
ンの処理が可能とのように述べられているが、ネットワーク内でのトランザクション
が活発になり特定のチャネルへのトランザクションの集中などが起こる可能性を考
慮すると、トランザクションの成功確率を高めネットワークでのトランザクション件
数の最大化を目指す必要がある。
将来のデータ量増加に伴って問題になると言われている LN のルーティング問題に
おいて、アニーリングマシンの応用可能性が示せたことはインパクトがあると考える。
参考文献
[1]Lightning Network 「Lightning Network 」< https://lightning.network/#intro > （最終
アクセス 2019 年 3 月 1 日）