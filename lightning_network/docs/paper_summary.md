# 論文要約: アニーリングを用いたブロックチェーンの高速化技術の開発

**プログラム**: 2018年度未踏ターゲット事業  
**分野**: 量子アニーリング、ブロックチェーン、Lightning Network

---

## 📋 論文の概要

本研究は、Lightning Network (LN) のトランザクション経路探索問題を、量子アニーリングマシン（富士通デジタルアニーラ）を用いて解決する手法を開発したものです。

## 🎯 研究の背景と目的

### 背景

1. **ビットコインのスケーラビリティ問題**
   - VISA: 約4,000件/秒
   - ビットコイン: 約7件/秒
   - 実社会の取引ニーズに対応できていない

2. **Lightning Networkの登場**
   - オフチェーン技術によるスケーラビリティ問題の解決策
   - 数百万〜数十億の同時トランザクション処理が理論上可能

3. **課題: ルーティング問題**
   - ネットワークが大規模化するにつれて経路探索が困難に
   - 効率的なルーティングアルゴリズムが必要

### 目的

アニーリングマシンを使用して、Lightning Network のトランザクション経路探索をより効率的に行う手法を開発する。

## 🔬 手法

### アプローチ

二段階のアプローチを採用：

1. **第一段階**: 各トランザクションに対して3つの候補経路を生成
2. **第二段階**: アニーリングマシンで最適な経路を選択

### 制約条件

Lightning Network におけるトランザクションの経路が満たすべき条件：

#### (1) キャパシティ制約
- チャネルには取引可能な金額の上限（キャパシティ）が存在
- これを超える金額のトランザクションは経由できない
- 双方向支払いチャネルの作成時に総量が定められる

#### (2) ルート制約
- 送出したノードから受取ノードまでの経路は**ただ1つ**
- 各トランザクションは1本の経路のみを選択

### 数学的定式化

#### 変数定義

- **x[i][j]**: 二値変数（トランザクション数 × 候補経路数の行列）
  - x[i][j] = 1: トランザクションiが経路jを使用
  - x[i][j] = 0: 使用しない

#### ハミルトニアンの構成

**1. キャパシティコストのハミルトニアン (H_capacity)**

全てのチャネルに対して、そのチャネルを通る容量がキャパシティより大きいとペナルティが発生。

- 対数エンコーディングを利用して効率化
- キャパシティ容量を最小ビット数で表現

**2. ルート制限のハミルトニアン (H_route)**

各トランザクションで1つのルートのみが選択される制約。

```
Σ_j x[i][j] = 1  (各トランザクションiについて)
```

**3. 距離コストのハミルトニアン (H_distance)**

- トランザクションはノードを経由するたびに手数料が課される
- できるだけ短い経路（経由するチャネル数が少ない）が好まれる
- 距離 = 経由するチャネルの数

**総ハミルトニアン**

```
H_total = H_capacity + α × H_route + β × H_distance
```

### パラメータ設定

- **α**: 2
- **β**: トランザクション金額の平均値の二乗 × 100
  - キャパシティコストの出力が大きくなることへの対称性を持たせるため

## 🧪 実験設定

### グラフ構造

- **生成ツール**: Python NetworkX 2.2
- **ノード数**: 2,000
- **チャネル数**: 20,000
- **各ノードのチャネル数**: 約15〜30（ランダムに配置）
- **キャパシティ範囲**: 200〜900

### トランザクション設定

- **トランザクション数**: 4
- **金額範囲**: 200〜600
- **候補経路数**: 各トランザクションにつき3つ

### 経路候補の生成方法

- チャネルの手数料に「平均0.1、標準偏差1の乱数」を掛け合わせたものを重みとする
- グラフにおける最短経路を**Dijkstra法**で求める
- これをルートの候補とする

### ソルバー設定

- **使用マシン**: 富士通デジタルアニーラ
- **モード**: FujituDAPTSolver
- **number_iterations**: 1,000,000
- **number_replicas**: 100

## 📊 実験結果

### 主な結果

- **実行時間**: 10秒（通信時間を含む）
- **使用ビット数**: 361ビット
- **制約充足**: (1), (2) の制約を満たす解を取得
- **最適性**: 短い距離の経路を解として取得

### 成功要因

1. 制約条件を適切に二値変数で定式化
2. ハミルトニアンの重みパラメータを適切に調整
3. 対数エンコーディングによる効率化

## 🌟 新規性・優位性

### 新規性

1. **Lightning Network のルーティング問題への量子アニーリングの適用**
   - LN のグラフ問題をアニーリングマシンで解くことに成功

2. **大規模ネットワークへの対応可能性**
   - 扱っているトランザクション数は少ないものの、LND開発チームのネットワークの**約2倍の規模**のグラフを解く足掛かり
   - 将来的な LN のルーティング問題へのアニーリングマシン応用可能性を示唆

### 優位性

1. **実用的な実行時間**
   - 10秒という実用的な時間で解を取得

2. **スケーラビリティへの道筋**
   - 2,000ノード、20,000チャネルという大規模グラフでの実証
   - 実際のLNは2018年時点で約1,000ノード

## 💡 期待されるユーザー価値と社会へのインパクト

### ユーザー価値

1. **トランザクション成功確率の向上**
   - 特定チャネルへの集中を避ける最適化
   - ネットワーク全体の効率化

2. **手数料の最小化**
   - 短い経路の選択により手数料を削減

3. **ネットワーク容量の最大化**
   - キャパシティ制約を考慮した最適化
   - より多くのトランザクションを処理可能

### 社会的インパクト

1. **スケーラビリティ問題の解決への貢献**
   - ビットコインの実用化促進
   - ブロックチェーン技術の社会実装加速

2. **将来のデータ量増加への対応**
   - LN のルーティング問題が深刻化する前に解決策を提示
   - 数百万〜数十億トランザクションの処理を見据えた技術

3. **量子アニーリングの実用化事例**
   - ブロックチェーン分野での量子コンピューティング活用
   - 他の組合せ最適化問題への応用可能性

## 🔍 技術的考察

### 強み

1. **制約の明確な定式化**
   - 実問題の制約を数学的に厳密に表現
   - ペナルティ項による制約違反の回避

2. **二段階アプローチ**
   - 候補生成と選択を分離することで計算効率化
   - Dijkstra法との組み合わせによる実用性

3. **パラメータチューニング**
   - αとβのバランスによる柔軟な最適化

### 今後の課題

1. **トランザクション数のスケール**
   - 4トランザクション → より多数への対応
   - 動的なトランザクション発生への対応

2. **リアルタイム性**
   - ネットワーク状態の変化への追従
   - より高速な再計算

3. **実装の実用化**
   - 実際のLNネットワークでの検証
   - プロトコルレベルでの統合

## 📚 参考文献・リンク

- Lightning Network 公式サイト: https://lightning.network/
- 論文での LND (Lightning Network Daemon) への言及
  - 2018年時点での主要な実装

## 🎓 学術的意義

本研究は、以下の点で学術的に意義があります：

1. **分野横断的アプローチ**
   - 量子コンピューティング × ブロックチェーン × ネットワーク最適化

2. **実問題への適用**
   - 理論だけでなく実装と検証を実施
   - 実用規模での性能評価

3. **将来性の示唆**
   - より大規模な問題への拡張可能性
   - 他のネットワークルーティング問題への適用可能性

---

## 📝 本実装について

このプロジェクトは、上記論文で提案された手法を、Fixstars Amplify を使用して再実装したものです。論文の設定を可能な限り忠実に再現し、さらに以下の機能を追加しています：

- モジュール化されたコード構造
- 包括的なテストスイート
- 詳細な可視化機能
- 柔軟なパラメータ設定
- GitHub での公開とドキュメント化

論文の成果を確認・拡張するための実装として活用してください。

